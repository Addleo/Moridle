<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moridle</title>
  <style>
    :root{
      --bg:#0f1220; --panel:#161A2A; --text:#E7EAF6; --muted:#9aa2c3;
      --ok:#2ECC71; --mid:#F1C40F; --bad:#3C455C; --accent:#7B6CFF;
      --border:#2a3050; --danger:#FF6B6B;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .wrap{max-width:960px;margin:0 auto;padding:24px}
    h1{font-size:clamp(22px,3vw,32px);margin:0 0 8px}
    .sub{color:var(--muted);margin-bottom:18px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
    .row{display:flex;gap:12px;align-items:center}
    input,button{background:#0b0e1a;border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px;font-size:14px}
    input:focus{outline:2px solid var(--accent)}
    button{cursor:pointer}
    button.primary{background:var(--accent);border:0}
    button.ghost{background:transparent}
    .grid{overflow:auto;border-radius:14px;border:1px solid var(--border)}
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:left;vertical-align:middle;}
    th{position:sticky;top:0;background:#12162a;z-index:1}

    .stat{display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:8px;font-weight:600}
    .ok{background:color-mix(in hsl, var(--ok) 25%, transparent);outline:1px solid color-mix(in hsl, var(--ok) 55%, #000);} 
    .mid{background:color-mix(in hsl, var(--mid) 25%, transparent);outline:1px solid color-mix(in hsl, var(--mid) 55%, #000);} 
    .bad{background:color-mix(in hsl, var(--bad) 25%, transparent);outline:1px solid color-mix(in hsl, var(--bad) 55%, #000);} 
    .namecell{display:flex;align-items:center;gap:10px}
    .avatar{width:36px;height:36px;border-radius:8px;background:#0b0e1a;border:1px solid var(--border);object-fit:cover}
    .sep{height:1px;background:var(--border);margin:14px 0}
    .hint{font-size:12px;color:var(--muted)}
    .flex{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .grow{flex:1}
    .right{margin-left:auto}
    .footer{opacity:.75;margin-top:16px;font-size:12px}
    .kbd{border:1px solid var(--border);border-bottom-color:#000;background:#0b0e1a;padding:2px 6px;border-radius:6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace}
    .share{white-space:pre-wrap;background:#0b0e1a;border-radius:12px;padding:10px;border:1px dashed var(--border)}
  </style>
</head>
<body>
<div class="wrap">
  <h1>Moridle</h1>
  <div class="sub">Guess the hidden character. Each player gets a new one every day!</div>

  <div class="panel" id="play">
    <div class="flex">
      <div class="grow row">
        <input id="guessInput" list="names" placeholder="Type a character nameâ€¦" autocomplete="off" />
        <datalist id="names"></datalist>
        <button id="btnGuess" class="primary">Guess</button>
        <button id="btnGiveUp" class="ghost">Give up</button>
      </div>
    </div>

    <div class="sep"></div>

    <div class="grid">
      <table id="results">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="end" style="display:none;margin-top:12px">
      <div id="endMsg" style="font-weight:700;margin-bottom:6px"></div>
      <div class="share" id="shareBox"></div>
      <div class="footer">Press <span class="kbd">Ctrl+C</span> to copy. Refresh for a new character tomorrow.</div>
    </div>
  </div>

  <div class="footer">Controls: Submit = <span class="kbd">Enter</span> â€¢ Focus input = <span class="kbd">/</span> â€¢ Clear = <span class="kbd">Esc</span></div>
</div>

<script>
// ============================
// 1) PASTE YOUR DATASET HERE
// ============================
let characters = [
  {"name":"Ramona","realm":"Chaos","class":"Chorus","gender":"Female","traits":["Keyflare generation","Drawing"],"rarity":"SR"},
  {"name":"Ogier","realm":"Chaos","class":"Warden","gender":"Male","traits":["Shield","Str stacking"],"rarity":"SR"},
  {"name":"Doll","realm":"Chaos","class":"Chorus","gender":"Female","traits":["Healing","Aliemus battery"],"rarity":"SR"},
  // ... (rest of your characters)
];

characters = characters.map(c => ({
  ...c,
  image: `./Character_icons/${c.name}.png`
}));

// ============================
// 2) GAME LOGIC
// ============================
const $ = (sel, el=document) => el.querySelector(sel);
const byName = (a,b)=> a.name.localeCompare(b.name, undefined, {sensitivity:'base'});

function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return ((t^t>>>14)>>>0)/4294967296}}
function strSeed(s){let h=2166136261; for(let i=0;i<s.length;i++){h^=s.charCodeAt(i); h=(h*16777619)>>>0} return h>>>0}
function pickIndex(len, seed){const r=mulberry32(strSeed(seed))(); return Math.floor(r*len)}
function todayKey(){const d=new Date(); return d.toISOString().slice(0,10)}

function inferColumns(list){
  const keys = new Set();
  list.forEach(o=>Object.keys(o).forEach(k=>{if(k!=='name'&&k!=='image') keys.add(k)}));
  return [...keys];
}

function normalize(v){
  if(v==null) return '';
  if(Array.isArray(v)) return v.map(x=>normalize(x)).filter(Boolean);
  if(typeof v==='number') return v;
  return String(v).trim();
}

function compareCell(guessVal, answerVal){
  const g = normalize(guessVal), a = normalize(answerVal);
  if(Array.isArray(g)||Array.isArray(a)){
    const setG = new Set(Array.isArray(g)?g:[g]);
    const setA = new Set(Array.isArray(a)?a:[a]);
    const inter=[...setG].filter(x=>setA.has(x));
    if(inter.length){
      const exact = setG.size===setA.size && inter.length===setG.size;
      return {type: exact? 'ok':'mid', text: Array.isArray(guessVal)?guessVal.join(', '):guessVal}
    }
    return {type:'bad', text: Array.isArray(guessVal)?guessVal.join(', '):guessVal}
  }
  if(typeof g==='number'&&typeof a==='number'){
    if(g===a) return {type:'ok', text:g}
    return {type:'mid', text: g + (g<a?' â†‘':' â†“')}
  }
  const gs=String(g).toLowerCase(), as=String(a).toLowerCase();
  if(gs===as) return {type:'ok', text:guessVal}
  if(gs && as && (gs.includes(as)||as.includes(gs))) return {type:'mid', text:guessVal}
  return {type:'bad', text:guessVal}
}

let STATE = {list:[], cols:[], answer:null, attempts:[], finished:false};

function setupNamesDatalist(){
  const dl=$('#names'); dl.innerHTML='';
  STATE.list.sort(byName).forEach(c=>{
    const o=document.createElement('option'); o.value=c.name; dl.appendChild(o);
  });
}

function headerRow(){
  const thead=$('#results thead'); thead.innerHTML='';
  const tr=document.createElement('tr');
  const thName=document.createElement('th'); thName.textContent='Name'; tr.appendChild(thName);
  STATE.cols.forEach(k=>{const th=document.createElement('th'); th.textContent=k; tr.appendChild(th)});
  thead.appendChild(tr);
}

function rowFor(guess){
  const tr=document.createElement('tr');
  const tdName=document.createElement('td');
  const nameWrap=document.createElement('div'); nameWrap.className='namecell';
  const img=document.createElement('img'); img.className='avatar'; img.src=guess.image||''; img.alt='';
  img.style.display=guess.image?'block':'none';
  const nm=document.createElement('div'); nm.textContent=guess.name;
  nameWrap.appendChild(img); nameWrap.appendChild(nm); tdName.appendChild(nameWrap); tr.appendChild(tdName);

  STATE.cols.forEach(k=>{
    const td=document.createElement('td');
    const res=compareCell(guess[k], STATE.answer[k]);
    const span=document.createElement('span'); span.className=`stat ${res.type}`; span.textContent=res.text??'â€”';
    td.appendChild(span); tr.appendChild(td);
  });
  return tr;
}

function renderTable(){
  const tb=$('#results tbody'); tb.innerHTML='';
  STATE.attempts.forEach(g=> tb.appendChild(rowFor(g)));
}

function endGame(win){
  STATE.finished=true; $('#end').style.display='block';
  $('#endMsg').textContent = win ? `You got it in ${STATE.attempts.length} guesses!` : `It was ${STATE.answer.name}.`;
  const squares = STATE.attempts.map(g=>{
    return STATE.cols.map(k=>{
      const c=compareCell(g[k], STATE.answer[k]).type;
      return c==='ok'?'ðŸŸ©':c==='mid'?'ðŸŸ¨':'â¬›';
    }).join('');
  }).join('\n');
  $('#shareBox').textContent = `Moridle â€” ${win?STATE.attempts.length:'X'} tries\n${squares}`;
}

function guessByName(name){
  return STATE.list.find(x=>x.name.toLowerCase()===name.toLowerCase());
}

function handleGuess(){
  if(STATE.finished) return;
  const name=$('#guessInput').value.trim();
  const g=guessByName(name);
  if(!g){ $('#guessInput').focus(); return; }
  if(STATE.attempts.some(a=>a.name.toLowerCase()===g.name.toLowerCase())){
    $('#guessInput').value=''; $('#guessInput').focus(); return;
  }
  STATE.attempts.push(g);
  $('#guessInput').value='';
  renderTable();
  if(g.name===STATE.answer.name){ endGame(true); }
}

function startGame(){
  STATE.list=characters;
  STATE.cols=inferColumns(characters);

  // Daily per-player seed
  const today = todayKey();
  let seed=localStorage.getItem('moridle-seed-'+today);
  if(!seed){
    seed=Math.random().toString(36).slice(2);
    localStorage.setItem('moridle-seed-'+today,seed);
  }
  STATE.answer=characters[pickIndex(characters.length, seed)];
  STATE.attempts=[]; STATE.finished=false;

  setupNamesDatalist();
  headerRow();
  renderTable();
}

$('#btnGuess').onclick=handleGuess;
$('#guessInput').addEventListener('keydown',e=>{if(e.key==='Enter') handleGuess()});
$('#btnGiveUp').onclick=()=>{if(!STATE.finished) endGame(false)};
document.addEventListener('keydown',e=>{
  if(e.key==='/'){e.preventDefault();$('#guessInput').focus();}
  if(e.key==='Escape'){$('#guessInput').value='';}
});

startGame();
</script>
</body>
</html>
